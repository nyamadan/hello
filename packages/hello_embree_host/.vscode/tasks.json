{
  "version": "2.0.0",
  "tasks": [
    {
      "type": "shell",
      "label": "Docker: Build Image",
      "command": "docker",
      "args": ["build", "${workspaceFolder}/docker/build/emscripten", "-t", "hello_embree/build/emscripten"],
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "[Emscripten + Docker] CMake: configure",
      "command": "bash",
      "args": [
        "-c",
        "docker run -u $(id -u):$(id -g) -v ${workspaceFolder}:/m --rm hello_embree/build/emscripten emcmake cmake -G Ninja -S /m -B /m/build -DCMAKE_BUILD_TYPE=Release -DCMAKE_CROSSCOMPILING_EMULATOR=/usr/local/bin/node"
      ],
      "windows": {
        "command": "docker",
        "args": [
          "run",
          "-v", "${workspaceFolder}:/m",
          "--rm", "hello_embree/build/emscripten", 
          "emcmake", "cmake", "-G", "Ninja", "-S", "/m", "-B", "/m/build", "-DCMAKE_BUILD_TYPE=Release", " -DCMAKE_CROSSCOMPILING_EMULATOR=/usr/local/bin/node"
        ],
      },
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "[Emscripten + Docker] CMake: build",
      "command": "bash",
      "args": [
        "-c",
        "docker run -u $(id -u):$(id -g) -v ${workspaceFolder}:/m --rm hello_embree/build/emscripten cmake --build /m/build --config Release --parallel"
      ],
      "windows": {
        "command": "docker",
        "args": [
          "run",
          "-v", "${workspaceFolder}:/m",
          "--rm", "hello_embree/build/emscripten", 
          "cmake", "--build", "/m/build", "--config", "Release", "--parallel"
        ],
      },
      "group": "build",
      "problemMatcher": []
    },
    {
      "type": "shell",
      "label": "[Emscripten + Docker] CMake: test",
      "command": "bash",
      "args": [
        "-c",
        "docker run -u $(id -u):$(id -g) -v ${workspaceFolder}:/m --rm hello_embree/build/emscripten ctest --test-dir /m/build -C Release --output-on-failure"
      ],
      "windows": {
        "command": "docker",
        "args": [
          "run",
          "-v", "${workspaceFolder}:/m",
          "--rm", "hello_embree/build/emscripten", 
          "ctest", "--test-dir", "./m/build", "-C", "Release"
        ],
      },
      "group": "build",
      "problemMatcher": []
    }
  ]
}
